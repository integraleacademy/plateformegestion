<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ContrÃ´le des formateurs</title>

  <!-- CSS principal si tu lâ€™utilises -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>

<div style="max-width:1000px;margin:30px auto;background:#fff;padding:25px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);">

  <h2 style="margin-top:0;">ğŸ‘¨â€ğŸ« ContrÃ´le des formateurs</h2>

  <!-- Formulaire ajout formateur -->
  <form method="POST" action="{{ url_for('add_formateur') }}" style="display:flex;flex-wrap:wrap;gap:10px;align-items:flex-end;margin-bottom:20px;">
    <div style="flex:1 1 180px;">
      <label>Nom</label>
      <input type="text" name="nom" required style="width:100%;padding:6px 8px;border-radius:6px;border:1px solid #ddd;">
    </div>
    <div style="flex:1 1 180px;">
      <label>PrÃ©nom</label>
      <input type="text" name="prenom" required style="width:100%;padding:6px 8px;border-radius:6px;border:1px solid #ddd;">
    </div>
    <div style="flex:1 1 220px;">
      <label>Email</label>
      <input type="email" name="email" style="width:100%;padding:6px 8px;border-radius:6px;border:1px solid #ddd;">
    </div>
    <div style="flex:1 1 180px;">
      <label>TÃ©lÃ©phone</label>
      <input type="text" name="telephone" style="width:100%;padding:6px 8px;border-radius:6px;border:1px solid #ddd;">
    </div>
    <div>
      <button type="submit" style="padding:8px 14px;border:none;border-radius:8px;background:#1e8449;color:#fff;font-weight:600;cursor:pointer;">
        â• Ajouter
      </button>
    </div>
  </form>

  {% if formateurs %}
  <table style="width:100%;border-collapse:collapse;font-size:14px;">
    <thead>
      <tr style="background:#f4f6f7;">
        <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Formateur</th>
        <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Email</th>
        <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">TÃ©lÃ©phone</th>
        <th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">ConformitÃ©</th>
        <th style="text-align:right;padding:8px;border-bottom:1px solid #eee;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for f in formateurs %}
      <tr>
<td style="padding:8px;border-bottom:1px solid #f0f0f0;">
  <a href="{{ url_for('formateur_detail', fid=f.id) }}" style="text-decoration:none;color:#2c3e50;font-weight:600;">
    {{ f.prenom }} {{ f.nom|upper }}
  </a>

  {% if f.a_controler %}
    <span style="
      margin-left:8px;
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      background:#fff3cd;
      color:#8a6d3b;
      border:1px solid #ffeeba;
      vertical-align:middle;
    ">
      ğŸ“Œ Docs Ã  contrÃ´ler
    </span>
  {% endif %}
</td>

        <td style="padding:8px;border-bottom:1px solid #f0f0f0;">{{ f.email or "â€”" }}</td>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0;">{{ f.telephone or "â€”" }}</td>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0;">
          {% set conf = f.conformite %}
          {% if conf.total %}
            {{ conf.conformes }} / {{ conf.total }} conformes
          {% else %}
            â€”
          {% endif %}
        </td>
        <td style="padding:8px;border-bottom:1px solid #f0f0f0;text-align:right;">
          <a href="{{ url_for('formateur_detail', fid=f.id) }}" style="margin-right:8px;font-size:13px;">ğŸ” Ouvrir</a>
          <a href="{{ url_for('edit_formateur', fid=f.id) }}" style="margin-right:8px;font-size:13px;">âœï¸ Modifier</a>
          <form method="POST" action="{{ url_for('delete_formateur', fid=f.id) }}" style="display:inline;" onsubmit="return confirm('Supprimer ce formateur ?');">
            <button type="submit" style="border:none;background:none;color:#c0392b;font-size:13px;cursor:pointer;">ğŸ—‘ï¸ Supprimer</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p style="margin-top:10px;">Aucun formateur enregistrÃ© pour le moment.</p>
  {% endif %}

<!-- ===== LISTE DES CLÃ‰S & BADGES (vue dÃ©taillÃ©e) ===== -->
<div style="margin-top:40px;padding:20px;background:#f8f9fa;border-radius:12px;">

  <!-- === DOCUMENT ORGANIGRAMME CLÃ‰S === -->
<h3 style="margin-top:0;margin-bottom:15px;">ğŸ“„ Plan dâ€™organigramme</h3>

<iframe 
  src="{{ url_for('static', filename='upload/Organigramme cle.pdf') }}"
  style="width:100%;height:600px;border:1px solid #ddd;border-radius:8px;">
</iframe>

<hr style="margin:25px 0;">


  <!-- ğŸ”‘ CLÃ‰S -->
  <h3 style="margin-top:0;margin-bottom:15px;">ğŸ”‘ ClÃ©s</h3>

<table style="width:100%;border-collapse:collapse;font-size:14px;margin-bottom:30px;">
  <thead>
    <tr style="background:#eef1f5;">
      <th style="padding:8px;text-align:left;">NumÃ©ro</th>
      <th style="padding:8px;text-align:left;">Type</th>
      <th style="padding:8px;text-align:left;">AttribuÃ©e Ã </th>
    </tr>
  </thead>

<tbody>
{% for num, info in etat_cles.items() %}

<tr>
  <!-- NumÃ©ro -->
  <td style="padding:8px;border-bottom:1px solid #eee;font-weight:600;">
    {{ num }}
  </td>

  <!-- Type de clÃ© -->
  <td style="padding:8px;border-bottom:1px solid #eee;">
    <span style="font-weight:700; color:
  {% if info.type == 'PASS GENERAL' %}#f39c12
  {% elif info.type == 'PASS PARTIEL' %}#27ae60
  {% elif info.type == 'APPARTEMENT' %}#8e44ad
  {% elif info.type == 'VIOLET' %}#8e44ad
  {% else %}#8e44ad
  {% endif %}
">
  {{ info.type }}
</span>

  </td>

  <!-- SÃ©lecteur attribution -->
  <td style="padding:8px;border-bottom:1px solid #eee;">
    <select onchange="assignCle({{ num }}, this.value)"
            style="padding:6px 10px;border-radius:6px;border:1px solid #ccc;">

      <option value="" {% if info.attribue_a == 'Libre' %}selected{% endif %}>
        Libre
      </option>

      {% for f in formateurs %}
        <option value="{{ f.id }}"
          {% if info.attribue_a == f.prenom ~ ' ' ~ f.nom|upper %}selected{% endif %}
        >
          {{ f.prenom }} {{ f.nom|upper }}
        </option>
      {% endfor %}

    </select>
  </td>

</tr>

{% endfor %}
</tbody>


</table>


  <hr style="margin:25px 0;">

  <!-- ğŸŸ¦ BADGES -->
  <h3 style="margin-bottom:15px;">ğŸŸ¦ Badges portail</h3>

  <table style="width:100%;border-collapse:collapse;font-size:14px;">
    <thead>
      <tr style="background:#eef1f5;">
        <th style="padding:8px;text-align:left;">NumÃ©ro</th>
        <th style="padding:8px;text-align:left;">AttribuÃ© Ã </th>
      </tr>
    </thead>
<tbody>
{% for num, info in etat_badges.items() %}

<tr>
  <td style="padding:8px;border-bottom:1px solid #eee;font-weight:600;">
    {{ num }}
  </td>

  <td style="padding:8px;border-bottom:1px solid #eee;">
    <select onchange="assignBadge({{ num }}, this.value)"
            style="padding:6px 10px;border-radius:6px;border:1px solid #ccc;">

      <!-- Option libre -->
      <option value="" {% if info.attribue_a == 'Libre' %}selected{% endif %}>
        Libre
      </option>

      <!-- Formateurs -->
      {% for f in formateurs %}
        <option value="{{ f.id }}"
          {% if info.attribue_a == f.prenom ~ ' ' ~ f.nom|upper %}selected{% endif %}>
          {{ f.prenom }} {{ f.nom|upper }}
        </option>
      {% endfor %}
    </select>
  </td>
</tr>

{% endfor %}
</tbody>

  </table>

</div>




</div>

  <script>
function assignCle(numero, fid) {
    fetch("/cle/assign", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ numero: numero, fid: fid })
    })
    .then(r => r.json())
    .then(data => {
        if (data.ok) {
            location.reload();
        } else {
            alert("Erreur : " + (data.error || "Impossible dâ€™attribuer la clÃ©."));
        }
    });
}
</script>

  <script>
function assignBadge(numero, fid) {
    fetch("/badge/assign", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ numero: numero, fid: fid })
    })
    .then(r => r.json())
    .then(data => {
        if (data.ok) {
            location.reload();
        } else {
            alert("Erreur : " + (data.error || "Impossible dâ€™attribuer le badge."));
        }
    });
}
</script>


  

</body>
</html>












