<div class="step" id="step{{ i }}" 
     data-done="{{ 'true' if entry.step.done else 'false' }}"
     data-name="{{ entry.step.name|lower }}">

  <div class="step-head">
    {% if entry.step.done %}
      <div class="status-chip ok">âœ… Ã‰tape validÃ©e</div>
    {% else %}
      <div class="status-chip 
           {% if entry.st.status == 'on_time' %}ok
           {% elif entry.st.status == 'upcoming' %}upcoming
           {% elif entry.st.status == 'late' %}late
           {% else %}na{% endif %}">
        {% if entry.st.status == 'on_time' %}
          ğŸŸ¢ Ã€ temps
        {% elif entry.st.status == 'upcoming' %}
          ğŸŸ  Ã€ venir
        {% elif entry.st.status == 'late' %}
          ğŸ”´ En retard
        {% else %}
          â€”
        {% endif %}
      </div>
    {% endif %}
  </div>

  <form method="post" action="{{ url_for('toggle_step', sid=s.id) }}#step{{ i }}">
    <input type="hidden" name="index" value="{{ i }}">
    <button type="submit" class="step-btn {% if entry.step.done %}done{% endif %}">
      <span class="icon">{% if entry.step.done %}âœ…{% else %}âœï¸{% endif %}</span>
      <span class="label">{{ entry.step.name }}</span>
    </button>
  </form>

  {% if entry.step.done and entry.step.done_at %}
    <div class="done-info">Ã‰tape validÃ©e le {{ entry.step.done_at }}</div>
  {% else %}
    {% if entry.deadline %}
      {% set diff = (entry.deadline.date() - now().date()).days %}
      <div class="status-text">
        {% if diff < 0 %}
          âš ï¸ Retard de {{ diff|abs }} jours ({{ entry.deadline.strftime('%d/%m/%Y') }})
        {% elif diff == 0 %}
          ğŸŸ¢ Aujourdâ€™hui ({{ entry.deadline.strftime('%d/%m/%Y') }})
        {% elif diff == 1 %}
          ğŸ•“ Demain ({{ entry.deadline.strftime('%d/%m/%Y') }})
        {% else %}
          â³ Dans {{ diff }} jours ({{ entry.deadline.strftime('%d/%m/%Y') }})
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
</div>
