<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ title }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script defer src="{{ url_for('static', filename='js/clock.js') }}"></script>

  <style>
    body {
      font-family: "Inter", sans-serif;
      background-color: #f9f9fb;
      margin: 0;
      color: #222;
    }

    /* HEADER */
    header.topbar {
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    header .brand {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    header .logo {
      height: 60px;
      border-radius: 50%;
    }
    header h1 {
      font-size: 22px;
      margin: 0;
      font-weight: 600;
    }
    header h1 span {
      color: #f4c45a;
    }
    .clock {
      font-size: 13px;
      color: #777;
      margin-top: 3px;
    }

    /* MAIN GRID */
    .container {
      max-width: 1300px;
      margin: 40px auto;
      padding: 0 30px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-top: 25px;
    }

    /* CARDS */
    .card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.03);
      padding: 25px;
      text-decoration: none;
      color: inherit;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 170px;
      border: 1px solid #eee;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.05);
    }
    .emoji {
      font-size: 28px;
      margin-bottom: 8px;
    }
    .title {
      font-size: 16px;
      font-weight: 600;
      color: #111;
    }
    .desc {
      color: #777;
      font-size: 14px;
      margin-top: 2px;
    }

    /* NOTIFICATIONS */
    .notif {
      margin-top: 12px;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      border-radius: 20px;
      text-align: center;
      width: fit-content;
      align-self: flex-start;
    }
    .notif.ok {
      background: rgba(39, 174, 96, 0.1);
      color: #1e8449;
    }
    .notif.wait {
      background: rgba(241, 196, 15, 0.15);
      color: #b9770e;
    }
    .notif.alert {
      background: rgba(231, 76, 60, 0.15);
      color: #c0392b;
    }
    .notif.error {
      background: rgba(231, 76, 60, 0.1);
      color: #c0392b;
    }

    /* SECTION TITLES */
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #d9b55b;
      margin-top: 60px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    /* FOOTER */
    footer.footer {
      text-align: center;
      font-size: 13px;
      color: #999;
      padding: 30px 0;
      margin-top: 60px;
      border-top: 1px solid #eee;
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <img src="{{ url_for('static', filename='img/logo-integrale.png') }}" alt="Logo Int√©grale Academy" class="logo">
      <div>
        <h1>Plateforme de gestion <span>Int√©grale Academy</span></h1>
        <div id="clock" class="clock">‚Äî</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <a class="card" href="https://assistance-alw9.onrender.com/admin" target="_blank" rel="noopener">
        <div>
          <div class="emoji">üõü</div>
          <div class="title">Assistance</div>
          <div class="desc">Acc√©der au centre d'aide</div>
        </div>
      </a>

      <a class="card" href="https://cnapsv5-1.onrender.com/admin" target="_blank" rel="noopener">
        <div>
          <div class="emoji">üì§</div>
          <div class="title">D√©p√¥t dossiers CNAPS</div>
          <div class="desc">Espace d'administration</div>
        </div>
        <div id="notif-cnaps" class="notif wait">üì© Chargement...</div>
      </a>

      <a class="card" href="https://inscriptions-akou.onrender.com/admin" target="_blank" rel="noopener">
        <div>
          <div class="emoji">üéì</div>
          <div class="title">Gestion des dossiers stagiaires</div>
          <div class="desc">Inscriptions & pi√®ces</div>
        </div>
        <div id="notif-stagiaires" class="notif wait">üéì Chargement...</div>
      </a>

      <a class="card" href="https://vtc-qh20.onrender.com/admin" target="_blank" rel="noopener">
        <div>
          <div class="emoji">üöñ</div>
          <div class="title">Examens VTC</div>
          <div class="desc">Administration examens</div>
        </div>
        <div id="notif-vtc" class="notif wait">üöñ Chargement...</div>
      </a>

      <a class="card" href="https://bts-wpfy.onrender.com/admin" target="_blank" rel="noopener">
        <div>
          <div class="emoji">üìù</div>
          <div class="title">Gestion contrats d'apprentissage</div>
          <div class="desc">Cr√©ation & suivi</div>
        </div>
        <div id="notif-contrats" class="notif wait">üìù Chargement...</div>
      </a>

      <a class="card" href="https://factures-jx8r.onrender.com/login" target="_blank" rel="noopener">
        <div>
          <div class="emoji">üí∂</div>
          <div class="title">Gestion des factures</div>
          <div class="desc">Portail de facturation</div>
        </div>
        <div id="notif-factures" class="notif wait">üí∂ Chargement...</div>
      </a>

      <a class="card" href="{{ url_for('sessions_home') }}">
        <div>
          <div class="emoji">üìÖ</div>
          <div class="title">Gestion des sessions</div>
          <div class="desc">Param√©trage interne</div>
        </div>
        <div id="notif-sessions" class="notif wait">üìÖ Chargement...</div>
      </a>
    </div>

    <h2 class="section-title">Applications externes</h2>
    <div class="grid">
      <a class="card" href="https://integraleacademy.lightning.force.com/" target="_blank" rel="noopener">
        <div class="emoji">‚ö°</div>
        <div class="title">Salesforce</div>
        <div class="desc">CRM et gestion commerciale</div>
      </a>

      <a class="card" href="https://phone.onoffbusiness.com/calls" target="_blank" rel="noopener">
        <div class="emoji">üì±</div>
        <div class="title">Onoff</div>
        <div class="desc">T√©l√©phonie business</div>
      </a>

      <a class="card" href="https://calendly.com/" target="_blank" rel="noopener">
        <div class="emoji">üìÜ</div>
        <div class="title">Calendly</div>
        <div class="desc">Planification de rendez-vous</div>
      </a>

      <a class="card" href="https://app.quicktalk.com/calls" target="_blank" rel="noopener">
        <div class="emoji">‚òéÔ∏è</div>
        <div class="title">Quicktalk</div>
        <div class="desc">Standard t√©l√©phonique</div>
      </a>
    </div>
  </main>

  <footer class="footer">¬© <span id="year"></span> Int√©grale Academy ‚Äî Tous droits r√©serv√©s</footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // üîÅ Fonctions de mise √† jour simplifi√©es (inchang√©es)
    async function updateCnaps() {
      const box = document.getElementById("notif-cnaps");
      try {
        const r = await fetch("https://cnapsv5-1.onrender.com/data.json");
        if (!r.ok) throw 0;
        const d = await r.json();
        const demandes = Array.isArray(d) ? d : d.demandes || [];
        const total = demandes.length;
        if (total > 0) { box.className = "notif wait"; box.innerHTML = `üì© ${total} demande${total>1?"s":""} CNAPS en attente`; }
        else { box.className = "notif ok"; box.innerHTML = "‚úÖ Aucune demande CNAPS en attente"; }
      } catch { box.className = "notif error"; box.innerHTML = "üîí Erreur CNAPS"; }
    }

    async function updateStagiaires() {
      const box = document.getElementById("notif-stagiaires");
      try {
        const r = await fetch("https://inscriptions-akou.onrender.com/data.json");
        if (!r.ok) throw 0;
        const d = await r.json();
        const c = (Array.isArray(d)?d:d.dossiers||[]).filter(x=>!x.status||x.status.trim()===""||x.status==="INCOMPLET").length;
        if (c > 0) { box.className = "notif wait"; box.innerHTML = `üéì ${c} dossier${c>1?"s":""} stagiaire${c>1?"s":""} √† traiter`; }
        else { box.className = "notif ok"; box.innerHTML = "‚úÖ Aucun dossier stagiaire en attente"; }
      } catch { box.className = "notif error"; box.innerHTML = "üîí Erreur Inscriptions"; }
    }

    async function updateVtc() {
      const box = document.getElementById("notif-vtc");
      try {
        const r = await fetch("https://vtc-qh20.onrender.com/data.json");
        if (!r.ok) throw 0;
        const d = await r.json();
        const c = (Array.isArray(d)?d:[]).filter(x=>!x.statut||x.statut.trim().toUpperCase()==="A INSCRIRE A L'EXAMEN").length;
        if (c > 0) { box.className = "notif wait"; box.innerHTML = `üöñ ${c} dossier${c>1?"s":""} VTC √† inscrire`; }
        else { box.className = "notif ok"; box.innerHTML = "‚úÖ Aucun dossier VTC en attente"; }
      } catch { box.className = "notif error"; box.innerHTML = "üîí Erreur VTC"; }
    }

    async function updateContrats() {
      const box = document.getElementById("notif-contrats");
      try {
        const r = await fetch("https://bts-wpfy.onrender.com/data.json");
        if (!r.ok) throw 0;
        const d = await r.json();
        const s = d.summary || {};
        const total = (s.a_traiter||0)+(s.signature_en_cours||0)+(s.saisi_entreprise||0);
        if (total > 0) {
          box.className = "notif wait";
          box.innerHTML = `üìù ${s.a_traiter||0} √† traiter, ${s.signature_en_cours||0} en signature, ${s.saisi_entreprise||0} en saisie`;
        } else {
          box.className = "notif ok";
          box.innerHTML = "‚úÖ Aucun contrat en attente";
        }
      } catch { box.className = "notif error"; box.innerHTML = "üîí Erreur Contrats"; }
    }

    async function updateFactures() {
      const box = document.getElementById("notif-factures");
      try {
        const r = await fetch("https://factures-jx8r.onrender.com/data.json");
        if (!r.ok) throw 0;
        const d = await r.json();
        const c = d.count || 0;
        if (c > 0) { box.className = "notif wait"; box.innerHTML = `üí∂ ${c} facture${c>1?"s":""} √† r√©gler`; }
        else { box.className = "notif ok"; box.innerHTML = "‚úÖ Aucune facture en attente"; }
      } catch { box.className = "notif error"; box.innerHTML = "üîí Erreur Factures"; }
    }

    async function updateSessions() {
      const box = document.getElementById("notif-sessions");
      try {
        const r = await fetch("https://plateformegestion.onrender.com/data.json");
        if (!r.ok) throw 0;
        const d = await r.json();
        const retard = d.retards || 0;
        if (retard > 0) { box.className = "notif alert"; box.innerHTML = `‚ö†Ô∏è ${retard} √©tape${retard>1?"s":""} en retard`; }
        else { box.className = "notif ok"; box.innerHTML = "‚úÖ Dans les temps"; }
      } catch { box.className = "notif error"; box.innerHTML = "üîí Erreur Sessions"; }
    }

    function refreshAll() {
      updateCnaps(); updateStagiaires(); updateVtc(); updateContrats(); updateFactures(); updateSessions();
    }
    refreshAll();
    setInterval(refreshAll, 15000);
  </script>
</body>
</html>
