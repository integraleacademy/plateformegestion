<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ title }}</title>

  <!-- ✅ Feuille de style principale -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script defer src="{{ url_for('static', filename='js/clock.js') }}"></script>

  <style>
    @keyframes pulse {0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);} }

    .notif {
      margin-top: 8px;
      font-size: 14px;
      font-weight: 600;
      padding: 6px 10px;
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .notif.ok {background: rgba(39, 174, 96, 0.1); color: #1e8449;}
    .notif.wait {background: rgba(241, 196, 15, 0.15); color: #b9770e; animation: pulse 2s infinite;}
    .notif.error {background: rgba(231, 76, 60, 0.15); color: #c0392b;}
    .notif.alert {background: rgba(231, 76, 60, 0.1); color: #c0392b; font-weight: 700; animation: pulse 1.5s infinite;}

    /* ✅ Encadré dossiers acceptés */
    .recent-acceptes {
      background: #fff;
      border-radius: 12px;
      padding: 14px 18px;
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
      border: 1px solid rgba(0,0,0,.06);
      margin: 20px 0;
    }
    .recent-acceptes h3 {
      margin: 0 0 8px;
      color: #1e8449;
      font-size: 16px;
      font-weight: 700;
    }
    .recent-acceptes ul {
      list-style: none;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    .recent-acceptes li::before {
      content: "• ";
      color: #27ae60;
      font-weight: bold;
    }
    .recent-acceptes.none {
      opacity: .8;
      color: #555;
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <img src="{{ url_for('static', filename='img/logo-integrale.png') }}" alt="Logo Intégrale Academy" class="logo">
      <div>
        <h1>Plateforme de gestion <span>Intégrale Academy</span></h1>
        <div id="clock" class="clock">—</div>
      </div>
    </div>
  </header>

  <main class="container">

    <!-- ✅ Bloc dossiers CNAPS acceptés -->
    <div class="recent-acceptes" id="recent-acceptes">
      <h3>✅ Dossiers CNAPS acceptés cette semaine</h3>
      <div id="liste-acceptes">Chargement...</div>
    </div>

    <div class="grid">
      <!-- ✅ Assistance -->
      <a class="card" href="https://assistance-alw9.onrender.com/admin" target="_blank" rel="noopener">
        <div class="emoji">🛟</div>
        <div class="title">Assistance</div>
        <div class="desc">Centre de support</div>
        <div id="notif-assistance" class="notif empty">🛟 Chargement...</div>
      </a>

      <a class="card" href="https://cnapsv5-1.onrender.com/admin" target="_blank" rel="noopener">
        <div class="emoji">📤</div>
        <div class="title">Dépôt dossiers CNAPS</div>
        <div class="desc">Espace d'administration</div>
        <div id="notif-cnaps" class="notif empty">📩 Chargement...</div>
      </a>

      <a class="card" href="https://cnapsv3.onrender.com/" target="_blank" rel="noopener">
        <div class="emoji">📊</div>
        <div class="title">Suivi des demandes CNAPS</div>
        <div class="desc">Surveillance des statuts</div>
        <div id="notif-suivi" class="notif empty">📊 Chargement...</div>
      </a>

      <a class="card" href="https://inscriptions-akou.onrender.com/admin" target="_blank" rel="noopener">
        <div class="emoji">🎓</div>
        <div class="title">Gestion des dossiers stagiaires</div>
        <div class="desc">Inscriptions & pièces</div>
        <div id="notif-stagiaires" class="notif empty">🎓 Chargement...</div>
      </a>

      <a class="card" href="https://vtc-qh20.onrender.com/admin" target="_blank" rel="noopener">
        <div class="emoji">🚖</div>
        <div class="title">Examens VTC</div>
        <div class="desc">Administration examens</div>
        <div id="notif-vtc" class="notif empty">🚖 Chargement...</div>
      </a>

      <a class="card" href="https://bts-wpfy.onrender.com/admin" target="_blank" rel="noopener">
        <div class="emoji">📝</div>
        <div class="title">Contrats d'apprentissage</div>
        <div class="desc">Création & suivi</div>
        <div id="notif-contrats" class="notif empty">📝 Chargement...</div>
      </a>

      <a class="card" href="https://factures-jx8r.onrender.com/login" target="_blank" rel="noopener">
        <div class="emoji">💼</div>
        <div class="title">Gestion des factures</div>
        <div class="desc">Portail de facturation</div>
        <div id="notif-factures" class="notif empty">💼 Chargement...</div>
      </a>

      <a class="card" href="{{ url_for('sessions_home') }}">
        <div class="emoji">📅</div>
        <div class="title">Gestion des sessions</div>
        <div class="desc">Paramétrage interne</div>
        <div id="notif-sessions" class="notif empty">📅 Chargement...</div>
      </a>
    </div>

    <h2 class="section-title">Applications externes</h2>
    <div class="grid">
      <a class="card" href="https://integraleacademy.lightning.force.com/" target="_blank" rel="noopener">
        <div class="emoji">⚡</div>
        <div class="title">Salesforce</div>
        <div class="desc">CRM et gestion commerciale</div>
      </a>

      <a class="card" href="https://phone.onoffbusiness.com/calls" target="_blank" rel="noopener">
        <div class="emoji">📞</div>
        <div class="title">Onoff</div>
        <div class="desc">Téléphonie business</div>
      </a>

      <a class="card" href="https://calendly.com/" target="_blank" rel="noopener">
        <div class="emoji">📆</div>
        <div class="title">Calendly</div>
        <div class="desc">Planification de rendez-vous</div>
      </a>

      <a class="card" href="https://app.quicktalk.com/calls" target="_blank" rel="noopener">
        <div class="emoji">☎️</div>
        <div class="title">Quicktalk</div>
        <div class="desc">Standard téléphonique</div>
      </a>
    </div>
  </main>

  <footer class="footer">© <span id="year"></span> Intégrale Academy — Tous droits réservés</footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ✅ Bloc CNAPS Acceptés
    async function updateRecentAcceptes() {
      const box = document.getElementById("liste-acceptes");
      try {
        const r = await fetch("https://cnapsv3.onrender.com/recent_acceptes.json");
        if (!r.ok) throw 0;
        const d = await r.json();
        const list = d.recent_acceptes || [];
        if (list.length === 0) {
          box.innerHTML = "<em>Aucun dossier accepté ces 7 derniers jours.</em>";
        } else {
          box.innerHTML = "<ul>" + list.map(x =>
            `<li><strong>${x.nom}</strong> ${x.prenom}</li>`
          ).join("") + "</ul>";
        }
      } catch {
        box.innerHTML = "<span style='color:#c0392b'>Erreur de chargement</span>";
      }
    }
    updateRecentAcceptes();
    setInterval(updateRecentAcceptes, 60000);

    // --- Reste du script identique ---
    function refreshAll() {
      updateAssistance(); updateCnaps(); updateSuivi(); updateStagiaires(); updateVtc(); updateContrats(); updateFactures(); updateSessions();
    }
    refreshAll();
    setInterval(refreshAll, 15000);
  </script>
</body>
</html>
